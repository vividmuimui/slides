<section>
  <h1>Rubyä¼šè­°ã§ã®Bundler2ã®è©±</h1>

  <p>
    <a href="https://github.com/vividmuimui" class="user-mention"
      >@vividmuimui</a
    ><br />
    2017/10/05 ç¤¾å†…LT
  </p>
</section>
<section>
  <p><img src="images/schedule.png" /></p>

  <p>ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã¯ã€åŸºæœ¬çš„ã«ã¯ã“ã®ç™ºè¡¨ã‚’ãªãã£ã¦ã„ã¾ã™</p>

  <p>
    <a href="http://rubykaigi.org/2017/presentations/0xColby.html"
      >http://rubykaigi.org/2017/presentations/0xColby.html</a
    ><br />
    youtube:
    <a href="https://www.youtube.com/watch?v=sZX7SK3hxk4"
      >https://www.youtube.com/watch?v=sZX7SK3hxk4</a
    ><br />
    speakerdeck:
    <a href="https://speakerdeck.com/colby/what-weve-been-up-to-with-bundler"
      >https://speakerdeck.com/colby/what-weve-been-up-to-with-bundler</a
    ><br />
    rfc#6:
    <a href="https://github.com/bundler/rfcs/pull/6"
      >https://github.com/bundler/rfcs/pull/6</a
    >
  </p>
</section>
<section>
  <h1>ã“ã®1å¹´ã§å…¥ã£ãŸã‚„ã¤ã®ç´¹ä»‹</h1>

  <ul>
    <li>bundle doctor</li>
    <li>bundle add</li>
    <li>bundle plugin</li>
  </ul>
</section>
<section>
  <h2>bundle doctor</h2>

  <p>skip</p>
</section>
<section>
  <h2>bundle add</h2>

  <pre><code class="language-console">$ bundle add rspec
</code></pre>

  <pre><code class="language-ruby"># Gemfile

# Added at 2017-10-04 00:17:42 +0900 by vividmuimui:
gem "rspec", "~&gt; 3.6"
</code></pre>

  <p>ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚æŒ‡å®šã§ãã‚‹</p>

  <pre><code class="language-console">$ bundle add rails --version "~&gt; 5.0.0" --source "https://gems.example.com" --group "development"
</code></pre>

  <p>botã¨ã‹ãªã‚‰ä½¿ã„ã¿ã¡ã‚ã‚‹ã‹ã‚‚ï¼Ÿ</p>
</section>
<section>
  <h2>bundler plugins</h2>

  <pre><code class="language-ruby">module MyBundlerPlugin
  class Plugin &lt; Bundler::Plugin::API
    command "new-command"

    def exec(command, args)
      puts "Hello World"
    end
  end
end
</code></pre>

  <pre><code>$ bundle new-command
Hello World!
</code></pre>

  <p>
    ã¨ã„ã†æ„Ÿã˜ã§ã€æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨æ„ã§ãã‚‹<br />
    ã»ã‹ã«ã‚‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚‚å‡ºæ¥ãŸã‚Šã™ã‚‹ã¿ãŸã„
  </p>

  <pre><code class="language-ruby">Bundler::Plugin::API.hook "before-install-all" do |deps|
  puts "Installing #{deps.map(&amp;:name).join(', ')} ğŸ‘!"
end
</code></pre>

  <pre><code class="language-console">$ bundle install
Installing rack ğŸ‘!
Using bundler 1.15.4
...
...
</code></pre>
</section>
<section>
  <h2>bundler plugins</h2>

  <p>ä½œæˆã—ãŸpluginã®installã¯ä»¥ä¸‹ã®æ„Ÿã˜</p>

  <pre><code class="language-console">$ bundle plugin install my-bundler-plugin
</code></pre>

  <pre><code class="language-ruby"># Gemfile
plugin 'my-bundler-plugin'
</code></pre>

  <p>
    ã¾ã ã¾ã ã€<code>plugins</code>ã«é–¢ã—ã¦ã¯ã¾ã ã¾ã æ©Ÿèƒ½ã‚‚documentã‚‚bugfixã‚‚è¶³ã‚Šã¦ãªã„ã‚‰ã—ã„
  </p>
</section>
<section>
  <h2>1.16ãŒ1ç³»ã®æœ€å¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã‚‹äºˆå®š</h2>
</section>
<section>
  <h1>bundler2</h1>
</section>
<section>
  <h1>Removing</h1>

  <ul>
    <li>Ruby2.3æœªæº€ã®ã‚µãƒãƒ¼ãƒˆ</li>
    <li>Gemfile Source Shortcuts</li>
    <li><code>bundle show</code></li>
    <li><code>bundle viz</code></li>
    <li><code>bundle console</code></li>
    <li>persistent command arguments</li>
    <li><code>--with --without --path --system</code></li>
    <li><code>bundle package</code></li>
  </ul>

  <p>ã„ãã¤ã‹ã‹ã„ã¤ã¾ã‚“ã§ç´¹ä»‹</p>
</section>
<section>
  <h2>Ruby2.3æœªæº€ã®ã‚µãƒãƒ¼ãƒˆ</h2>

  <p>skip</p>
</section>
<section>
  <h2>Gemfile Source Shortcuts</h2>

  <pre><code class="language-ruby">gem "rack", github: "user/repo"
gem "rack", bitbuket: "user/repo"
</code></pre>

  <p>ã¨ã„ã£ãŸ<code>shortcut</code>ãŒãªããªã‚Šã€ä»¥ä¸‹ã®æ›¸ãæ–¹ã‚’ã™ã‚‹ã‚ˆã†ã«ãªã‚‹</p>

  <pre><code class="language-ruby">gem "gem1", source: "https://mygemserver.private"
gem "gem2", git: "https://github.com/user/repo.git"
gem "gem3", path: "path/to/gem"
</code></pre>

  <p>
    ãŸã ã€ä»Šã¾ã§æ›¸ã„ã¦ã„ãŸã‚ˆã†ã«<code>git_source</code>ã‚’æ›¸ã„ã¦ãŠã‘ã°<code
      >github: "user/repo"</code
    >ã‚‚æ›¸ã‘ã‚‹
  </p>

  <pre><code class="language-ruby">git_source(:github) do |repo_name|
  repo_name = "#{repo_name}/#{repo_name}" unless repo_name.include?("/")
  "https://github.com/#{repo_name}.git"
end

gem "rack", github: "user/repo"
</code></pre>
</section>
<section>
  <h2>bundle show</h2>

  <p>ç¾çŠ¶ã®<code>bundle show</code>ã¯æ©Ÿèƒ½ãŒãŸãã•ã‚“ã‚ã‚Šè¤‡é›‘</p>
  <ul>
    <li><code>bundle info</code></li>
    <li><code>bundle list</code></li>
  </ul>

  <p>ã®2ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã«åˆ†å‰²</p>
</section>
<section>
  <h2>bundle viz</h2>

  <p>pluginã¨ã—ã¦åˆ‡ã‚Šå‡ºã•ã‚Œã‚‹</p>

  <pre><code class="language-console">$ bunldle plugin install bundle-viz
</code></pre>
</section>
<section>
  <h2>bundle console</h2>

  <p>skip</p>
</section>
<section>
  <h2>persistent command arguments</h2>

  <p>
    ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã‚’è‡ªå‹•ã§è¨˜éŒ²ã™ã‚‹å‡¦ç†ãŒãªããªã‚‹<br />
    ãŸã¨ãˆã°ã€ä»Šã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»Šã¯è‡ªå‹•ã§configãƒ•ã‚¡ã‚¤ãƒ«ã«<code>path=foo</code>ã‚’è¨˜éŒ²ã•ã‚Œã‚‹ãŒã€ã•ã‚Œãªããªã‚‹
  </p>
  <pre><code class="language-console">$ bundle install --path foo
</code></pre>

  <p>
    æ¯å›å¸¸ã«optionã‚’æŒ‡å®šã™ã‚‹ã‹ã€ä»¥ä¸‹ã®ã‚ˆã†ã«configã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  </p>

  <pre><code class="language-console">$ bundle config path foo
</code></pre>
</section>
<section>
  <h2>â€“with â€“without â€“path â€“system</h2>

  <p>
    <code>bundle install</code>ã§ã®ä¸Šè¨˜optionã‚’å‰Šé™¤<br />
    ä»£ã‚ã‚Šã«<code>bundle config</code>ã‚’ä½¿ã†
  </p>
</section>
<section>
  <h2>bundle package</h2>

  <p><code>bundle package</code>ã‹ã‚‰<code>bundle cache</code>ã«å¤‰æ›´</p>
</section>
<section>
  <h1>Adding</h1>

  <p>Removingã«æ¯”ã¹ã¦å°‘ãªã„</p>

  <ul>
    <li>Global gem &amp; extension cache</li>
    <li>Specific platforms</li>
  </ul>
</section>
<section>
  <h2>Global gem &amp; extension cache</h2>

  <p>
    è¤‡æ•°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§åŒã˜gemã‚’ä½¿ã£ã¦ã„ãŸã‚Šã€<br />
    è¤‡æ•°rubyãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§åŒã˜gemã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ãã«installãŒé«˜é€ŸåŒ–ã•ã‚Œã‚‹
  </p>
</section>
<section>
  <h2>Specific platforms</h2>

  <p>é›£ã—ãã¦ã‚ˆãã‚ã‹ã‚“ãªã‹ã£ãŸï¼ï¼œ</p>
</section>
<section>
  <h1>Changing</h1>

  <ul>
    <li>bundle</li>
    <li>bundle update</li>
    <li>bundle1ã¨ã®äº’æ›æ€§</li>
    <li>gems.rb</li>
  </ul>
</section>
<section>
  <h2>bundle</h2>

  <p>
    ä»Šã¯<code>bundle install</code
    >ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŒã€usageãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹<br />
    <img src="images/usage.png" />
  </p>
</section>
<section>
  <h2>bundle update</h2>

  <p>ä»Šã¯ã€</p>
  <pre><code class="language-console">$ bundle update
</code></pre>

  <p>ã§å…¨gemã®updateãŒèµ°ã‚‹ãŒã€æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹</p>

  <pre><code class="language-console">$ bundle update &lt;gem-name&gt;
$ bundle update --all
</code></pre>

  <p>ã®ã©ã¡ã‚‰ã‹ã«ãªã‚‹</p>
</section>
<section>
  <h2>bundle1ã¨ã®äº’æ›æ€§</h2>

  <p>
    ä¸‹ä½äº’æ›ã¯ãªã„ã®ã§æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹<br />
    <code>bundler2</code>ã§<code>bundle install</code
    >ã—ãŸã‚‰<code>bundler1</code>ã§ã¯å‹•ã‹ãªã„<br />
    ãªã®ã§ã€ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã®è¶³ä¸¦ã¿åˆã‚ã›ã¦ã€ã›ãƒ¼ã®ã§ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹<br />
    (è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‹…å½“ã—ã¦ã„ã¦ã€åŒã˜rubyãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã¾ãŸã„ã§ã‚‚è¶³ä¸¦ã¿æƒãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ï¼Ÿ)
  </p>
</section>
<section>
  <h2>gems.rb</h2>

  <ul>
    <li>
      <code>bundler2</code>ã§<code>bundle init</code
      >ã—ãŸæ™‚ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯<code>gems.rb</code>ã«ãªã‚‹
    </li>
    <li>
      ä»Šã¾ã§ã®<code>Gemfile</code>, <code>Gemfile.lock</code>ã¯æ™®é€šã«ä½¿ãˆã‚‹
      <ul>
        <li>deprecation warningã‚‚ã§ãªã„</li>
      </ul>
    </li>
    <li>
      <code>gems.rb</code
      >ã¨<code>Gemfile</code>ãŒä¸¡æ–¹å­˜åœ¨ã—ã¦ã„ãŸã¨ãã¯ã€<code>gems.rb</code>ãŒå„ªå…ˆã•ã‚Œã‚‹
    </li>
  </ul>
</section>
<section>
  <h1>ä»Šå¾Œ</h1>
</section>
<section>
  <h2>Ruby2.5ã«default gemã¨ã—ã¦bundlerãŒå…¥ã‚‹</h2>

  <p>
    ã©ã®bundlerã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå…¥ã‚‹ã‹ã¯hsbtã•ã‚“ã¨ç›¸è«‡ã¨è¨€ã£ã¦ã„ãŸã‚ˆã†ã«èã“ãˆãŸ<br />
    ã§ã‚‚ã€2ç³»ã«ãªã‚Šãã†ãªé›°å›²æ°—ã ã£ãŸ(æ›–æ˜§)
  </p>
</section>
<section>
  <h2>æ¯å¹´ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚’ã™ã‚‹</h2>

  <p>
    rubyã®ãƒªãƒªãƒ¼ã‚¹ã®ã‚ˆã†ã«æ¯å¹´å¹´æœ«ã‚ãŸã‚Šã«ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒè¡Œã†ã‚ˆã†ã«ãªã‚‹<br />
    rubyã®ã‚µãƒãƒ¼ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰ãˆãŸã‚Šã€å¤ã„æ©Ÿèƒ½ã‚’å‰Šé™¤ã—ãŸã‚Šãªã©
  </p>
</section>
<section>
  <h1>ãŠã¾ã‘</h1>

  <p>
    <a href="https://github.com/bundler/rfcs/pull/6/">rfc#6</a>
    è¦‹ã¦ã¦æ°—ã«ãªã£ãŸã‚„ã¤
  </p>

  <ul>
    <li>
      <code>bundle install</code
      >ã—ãŸæ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆãŒ<code>./.bundle</code>ä»¥ä¸‹ã«ãªã‚‹
    </li>
  </ul>
</section>
